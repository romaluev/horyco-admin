# Admin Panel — Управление Меню (Menu Management)

Этот документ описывает фронтенд-задачи для раздела **Управление Меню** в Admin Panel. Все описанные эндпоинты уже реализованы на бэкенде (Stage 3.2) и готовы к интеграции. Материал объясняет бизнес-логику, навигацию между страницами, и контекст использования каждого API endpoint.

---

## 📋 Содержание

1. [Базовые концепции и термины](#базовые-концепции-и-термины)
2. [Навигация и структура меню](#навигация-и-структура-меню)
3. [Страница: Категории](#страница-категории)
4. [Страница: Продукты](#страница-продукты)
5. [Страница: Модификаторы](#страница-модификаторы)
6. [Страница: Дополнения (Additions)](#страница-дополнения-additions)
7. [Страница: Шаблоны меню](#страница-шаблоны-меню)
8. [Страница: Настройки по филиалам (Branch Overrides)](#страница-настройки-по-филиалам-branch-overrides)
9. [Типовые сценарии использования](#типовые-сценарии-использования)

---

## Базовые концепции и термины

### 🔑 Ключевые понятия системы меню

#### **Category (Категория)**
Группировка товаров для удобной навигации. Категории могут быть **иерархическими** (родительская → подкатегории).

**Примеры:**
- `Напитки` → `Горячие напитки`, `Холодные напитки`
- `Основные блюда` → `Паста`, `Пицца`, `Салаты`

**Зачем нужны:**
- Организация меню в POS и WebApp
- Группировка для аналитики продаж
- Визуальная категоризация для клиентов

#### **Product (Продукт)**
Основная единица меню — блюдо, напиток или товар, который продаётся клиентам.

**Обязательные поля:**
- `name` — название продукта
- `price` — базовая цена
- `categoryId` — категория, к которой относится
- `productTypeId` — тип продукта (еда, напиток, алкоголь и т.д.)

**Опциональные:**
- `description` — описание блюда
- `image` — фото продукта
- `isAvailable` — доступен ли для заказа
- `preparationTime` — время приготовления (мин)
- `calories` — калорийность
- `allergens` — список аллергенов

#### **Modifier (Модификатор)**
Опция изменения продукта с **дополнительной ценой**. Модификаторы группируются в **Modifier Groups**.

**Пример для "Бургер":**
```
Modifier Group: "Степень прожарки"
├── Well Done (+0 ₽)
├── Medium (+0 ₽)
└── Rare (+0 ₽)

Modifier Group: "Дополнительные ингредиенты"
├── Extra Cheese (+150 ₽)
├── Bacon (+200 ₽)
└── Avocado (+180 ₽)
```

**Зачем нужны:**
- Клиент может кастомизировать блюдо (размер, уровень остроты, топпинги)
- Автоматический расчёт финальной цены в заказе
- Кухня получает точные инструкции по приготовлению

**Важно:**
- Модификатор **обязательно принадлежит Modifier Group**
- Группа модификаторов привязывается к продукту
- Можно задать `minSelection` и `maxSelection` (например, "выберите 1-3 топпинга")

#### **Addition (Дополнение)**
Группа **опциональных позиций**, которые можно добавить к основному продукту. В отличие от модификаторов, дополнения состоят из **Addition Items** — отдельных продуктов со своей ценой.

**Пример для "Пицца Маргарита":**
```
Addition: "Соусы"
├── Чесночный соус (50 ₽)
├── Барбекю соус (50 ₽)
└── Сырный соус (70 ₽)

Addition: "Напитки к пицце"
├── Coca-Cola 0.5л (150 ₽)
├── Fanta 0.5л (150 ₽)
└── Минеральная вода (100 ₽)
```

**Свойства Addition:**
- `isRequired` — обязательно ли выбрать хотя бы один item
- `isMultiple` — можно ли выбрать несколько items
- `isCountable` — можно ли указать количество (например, 3 соуса)
- `minSelection` / `maxSelection` — ограничения выбора

**Отличие от Modifier:**
| Характеристика | Modifier | Addition |
|---------------|----------|----------|
| Цена | Добавляется к базовой цене продукта | Каждый item — отдельная цена |
| Структура | Плоский список опций в группе | Группа → Items (двухуровневая) |
| Использование | Изменение характеристик блюда | Дополнительные товары к блюду |
| Пример | Размер, прожарка, топпинги | Соусы, напитки, десерты |

#### **Branch Override (Настройки по филиалам)**
Возможность **переопределить параметры продукта** для конкретного филиала, не меняя базовую конфигурацию.

**Что можно переопределить:**
- `price` — цена для филиала (например, выше в центре города)
- `isAvailable` — доступность (сезонные блюда только в определённых локациях)
- `image` — локализованное фото
- `name` — локализованное название

**Пример использования:**
```
Продукт: "Капучино"
Базовая цена: 350 ₽

Branch Overrides:
├── Филиал "Центр" → 450 ₽ (дороже)
├── Филиал "Спальный район" → 300 ₽ (дешевле)
└── Филиал "Аэропорт" → недоступно (isAvailable=false)
```

**Зачем нужны:**
- Разные цены для разных локаций
- Региональные особенности меню
- Сезонные ограничения по филиалам
- Тестирование новых позиций в отдельных точках

#### **Menu Template (Шаблон меню)**
Готовый набор категорий и продуктов для быстрого старта нового ресторана.

**Примеры шаблонов:**
- "Кофейня" — кофе, чай, десерты, сэндвичи
- "Пиццерия" — пиццы, паста, салаты, напитки
- "Фаст-фуд" — бургеры, картофель фри, напитки
- "Суши-бар" — роллы, сашими, супы, напитки

**Зачем нужны:**
- Ускорение онбординга новых клиентов
- Стандартизация меню для франшиз
- Готовая структура для новых филиалов

---

## Навигация и структура меню

### Главное меню Admin Panel

```
📊 Dashboard
📋 Заказы
🍔 Меню ← ВЫ ЗДЕСЬ
   ├── 📂 Категории
   ├── 🍕 Продукты
   ├── ⚙️ Модификаторы
   ├── ➕ Дополнения
   ├── 📑 Шаблоны меню
   └── 🏢 Настройки по филиалам
👥 Клиенты
👨‍💼 Сотрудники
🏪 Филиалы
💰 Финансы
⚙️ Настройки
```

### Навигационный Flow

```
Главная страница Меню
    ↓
┌───────────────────────────────────────┐
│  Список категорий / продуктов         │
│  + Поиск, фильтры, сортировка         │
└───────────────────────────────────────┘
    ↓ (клик на продукт)
┌───────────────────────────────────────┐
│  Детальная страница продукта          │
│  + Редактирование базовой информации  │
└───────────────────────────────────────┘
    ↓ (вкладка "Модификаторы")
┌───────────────────────────────────────┐
│  Управление модификаторами продукта   │
│  + Добавить / удалить группы          │
└───────────────────────────────────────┘
    ↓ (вкладка "Дополнения")
┌───────────────────────────────────────┐
│  Управление дополнениями              │
│  + Добавить / удалить additions       │
└───────────────────────────────────────┘
    ↓ (вкладка "По филиалам")
┌───────────────────────────────────────┐
│  Branch Overrides                     │
│  + Настроить цены/доступность         │
└───────────────────────────────────────┘
```

---

## Страница: Категории

### 📍 Навигация
**Путь:** `Admin Panel → Меню → Категории`
**URL:** `/admin/menu/categories`

### 🎯 Цель страницы
Управление иерархической структурой категорий меню. Менеджер может создавать, редактировать, удалять и переупорядочивать категории.

### 📋 API Endpoints

#### 1. Получить список категорий
```
GET /admin/menu/categories
Query параметры:
  - parentId? (number) — фильтр по родительской категории
  - includeProducts? (boolean) — включить количество продуктов
```

**Response:**
```json
[
  {
    "id": 1,
    "name": "Напитки",
    "description": "Горячие и холодные напитки",
    "image": "https://cdn.example.com/categories/beverages.jpg",
    "parentId": null,
    "sortOrder": 0,
    "isActive": true,
    "createdAt": "2025-01-20T10:00:00Z",
    "updatedAt": "2025-01-20T10:00:00Z",
    "children": [
      {
        "id": 2,
        "name": "Горячие напитки",
        "parentId": 1,
        "productCount": 12
      }
    ],
    "productCount": 25
  }
]
```

#### 2. Создать категорию
```
POST /admin/menu/categories
Body: {
  "name": "Десерты",
  "description": "Сладкие блюда и выпечка",
  "parentId": null,  // или ID родительской категории
  "image": "https://cdn.example.com/desserts.jpg",
  "sortOrder": 5,
  "isActive": true
}
```

#### 3. Обновить категорию
```
PATCH /admin/menu/categories/:id
Body: {
  "name": "Горячие десерты",
  "description": "Обновлённое описание"
}
```

#### 4. Удалить категорию
```
DELETE /admin/menu/categories/:id
```

**⚠️ Важно:**
- Нельзя удалить категорию с подкатегориями
- Нельзя удалить категорию с продуктами (нужно сначала переместить продукты)

#### 5. Изменить порядок категорий
```
PATCH /admin/menu/categories/reorder
Body: {
  "categoryIds": [3, 1, 2, 5, 4]  // новый порядок
}
```

### 🎨 UI Компоненты

**Список категорий:**
- Древовидная структура (Tree View) с drag-and-drop
- Иконка категории / заглушка
- Название + описание
- Счётчик продуктов
- Индикатор активности (вкл/выкл)
- Кнопки: Редактировать, Удалить, Добавить подкатегорию

**Модальное окно создания/редактирования:**
```
┌─────────────────────────────────────┐
│  Создать категорию                  │
├─────────────────────────────────────┤
│  Название: [_________________]      │
│  Описание: [_________________]      │
│  Родитель: [▼ Выбрать категорию]    │
│  Изображение: [📷 Загрузить]        │
│  Активна: [✓]                       │
│                                     │
│  [Отмена]  [Сохранить]              │
└─────────────────────────────────────┘
```

### ✅ Проверки и валидация

1. **Название категории:**
   - Обязательное поле
   - Максимум 100 символов
   - Не должно дублироваться на том же уровне

2. **Родительская категория:**
   - Нельзя выбрать саму себя
   - Нельзя создать циклическую зависимость (A → B → A)

3. **Удаление:**
   - Показать предупреждение, если есть подкатегории
   - Показать количество продуктов, которые будут затронуты

4. **Переупорядочивание:**
   - Drag-and-drop должен сохраняться автоматически
   - Показать индикатор загрузки при сохранении

### 🔄 Сценарии использования

**Создание иерархии:**
```
1. Менеджер создаёт "Напитки" (parentId=null)
2. Создаёт "Горячие напитки" (parentId=1)
3. Создаёт "Кофе" (parentId=2)
4. Переупорядочивает drag-and-drop
5. Система сохраняет новый sortOrder
```

**Редактирование:**
```
1. Клик на категорию → модалка
2. Меняем название / описание
3. PATCH /admin/menu/categories/:id
4. Обновляем список без перезагрузки
```

---

## Страница: Продукты

### 📍 Навигация
**Путь:** `Admin Panel → Меню → Продукты`
**URL:** `/admin/menu/products`

### 🎯 Цель страницы
Управление каталогом продуктов: создание, редактирование, контроль цен и доступности.

### 📋 API Endpoints

#### 1. Получить список продуктов (с фильтрами и пагинацией)
```
GET /admin/menu/products
Query параметры:
  - categoryId? (number) — фильтр по категории
  - available? (boolean) — только доступные / недоступные
  - q? (string) — поиск по названию
  - page? (number) — номер страницы (default: 1)
  - limit? (number) — элементов на странице (default: 20)
```

**Response:**
```json
{
  "data": [
    {
      "id": 101,
      "name": "Капучино",
      "description": "Классический кофе с молочной пенкой",
      "price": 350,
      "categoryId": 5,
      "categoryName": "Горячие напитки",
      "image": "https://cdn.example.com/cappuccino.jpg",
      "isAvailable": true,
      "sortOrder": 1,
      "createdAt": "2025-01-20T10:00:00Z",
      "updatedAt": "2025-01-22T15:30:00Z"
    }
  ],
  "total": 156,
  "page": 1,
  "limit": 20,
  "totalPages": 8
}
```

#### 2. Получить детали продукта
```
GET /admin/menu/products/:id
```

**Response:**
```json
{
  "id": 101,
  "name": "Капучино",
  "description": "Классический кофе с молочной пенкой",
  "price": 350,
  "categoryId": 5,
  "categoryName": "Горячие напитки",
  "productTypeId": 2,
  "image": "https://cdn.example.com/cappuccino.jpg",
  "isAvailable": true,
  "sortOrder": 1,
  "preparationTime": 5,
  "calories": 120,
  "allergens": ["молоко"],
  "modifierGroupsCount": 2,
  "additionsCount": 1,
  "createdAt": "2025-01-20T10:00:00Z",
  "updatedAt": "2025-01-22T15:30:00Z"
}
```

#### 3. Создать продукт
```
POST /admin/menu/products
Body: {
  "name": "Эспрессо",
  "description": "Крепкий чёрный кофе",
  "price": 200,
  "categoryId": 5,
  "productTypeId": 2,
  "image": "https://cdn.example.com/espresso.jpg",
  "isAvailable": true,
  "preparationTime": 3,
  "calories": 5,
  "allergens": []
}
```

#### 4. Обновить продукт
```
PATCH /admin/menu/products/:id
Body: {
  "name": "Двойной Эспрессо",
  "price": 280
}
```

#### 5. Быстрое обновление цены
```
PATCH /admin/menu/products/:id/price
Body: {
  "price": 320
}
```

**Зачем отдельный endpoint:**
- Быстрое массовое обновление цен
- Упрощённая валидация (только цена)
- Отдельное право доступа (может назначаться другой роли)

#### 6. Изменить доступность
```
PATCH /admin/menu/products/:id/availability
Body: {
  "isAvailable": false
}
```

**Использование:**
- Быстрое включение/выключение продукта
- Кнопка-переключатель в списке продуктов
- Временная недоступность (закончились ингредиенты)

#### 7. Удалить продукт
```
DELETE /admin/menu/products/:id
```

**⚠️ Важно:**
- Soft delete — продукт помечается `deletedAt`, но не удаляется физически
- Нельзя удалить, если есть активные заказы с этим продуктом

### 🎨 UI Компоненты

**Список продуктов (Table View):**
| Фото | Название | Категория | Цена | Доступность | Действия |
|------|----------|-----------|------|-------------|----------|
| 🖼️ | Капучино | Горячие напитки | 350 ₽ | ✅ Вкл | ✏️ 🗑️ |
| 🖼️ | Лате | Горячие напитки | 380 ₽ | ❌ Выкл | ✏️ 🗑️ |

**Фильтры:**
```
┌──────────────────────────────────────────┐
│ Категория: [▼ Все категории]             │
│ Поиск: [🔍 Название продукта...]          │
│ Статус: [▼ Все] [✓ Доступные] [ ] Скрыт  │
│ [Применить] [Сбросить]                   │
└──────────────────────────────────────────┘
```

**Модальное окно создания/редактирования:**
```
┌──────────────────────────────────────────┐
│  Редактировать продукт                   │
├──────────────────────────────────────────┤
│ Вкладки: [Основное] [Модификаторы]       │
│         [Дополнения] [По филиалам]       │
├──────────────────────────────────────────┤
│ Название: [Капучино______________]        │
│ Категория: [▼ Горячие напитки]           │
│ Цена: [350_₽] Время: [5_мин]             │
│ Описание: [____________________]         │
│ Калории: [120] Аллергены: [молоко]       │
│ Фото: [📷 Загрузить]                     │
│ Доступен: [✓]                            │
│                                          │
│ [Отмена] [Сохранить]                     │
└──────────────────────────────────────────┘
```

### ✅ Проверки и валидация

1. **Название продукта:**
   - Обязательное поле
   - Максимум 200 символов
   - Не должно дублироваться в категории

2. **Цена:**
   - Обязательное поле
   - Минимум 0 (бесплатные позиции допустимы)
   - Максимум 999999

3. **Категория:**
   - Обязательное поле
   - Должна существовать и быть активной

4. **ProductTypeId:**
   - Обязательное поле
   - Используется для классификации (еда, напиток, алкоголь)
   - Влияет на налогообложение и отчётность

### 🔄 Сценарии использования

**Быстрое изменение цены:**
```
1. В таблице продуктов клик по цене → инлайн редактор
2. Вводим новую цену
3. PATCH /admin/menu/products/:id/price
4. Цена обновляется без перезагрузки страницы
```

**Создание нового продукта:**
```
1. Кнопка "Добавить продукт"
2. Заполняем обязательные поля (название, цена, категория, тип)
3. Загружаем фото
4. POST /admin/menu/products
5. Переходим к редактированию модификаторов
```

---

## Страница: Модификаторы

### 📍 Навигация
**Путь:** `Admin Panel → Меню → Модификаторы`
**URL:** `/admin/menu/modifiers`

**Альтернативный путь:**
`Продукты → [Продукт] → Вкладка "Модификаторы"`

### 🎯 Цель страницы
Управление модификаторами и группами модификаторов для кастомизации продуктов.

### 💡 Бизнес-логика

**Архитектура:**
```
Product (Пицца Маргарита)
  └── Modifier Group: "Размер"
      ├── Modifier: "Маленькая (25см)" +0₽
      ├── Modifier: "Средняя (30см)" +200₽
      └── Modifier: "Большая (35см)" +400₽

  └── Modifier Group: "Дополнительные топпинги"
      ├── Modifier: "Моцарелла" +150₽
      ├── Modifier: "Пепперони" +180₽
      └── Modifier: "Грибы" +100₽
```

**Правила:**
- Modifier Group определяет: `minSelection`, `maxSelection`, `isRequired`
- Модификатор всегда принадлежит группе
- Модификатор имеет `price` (дополнительная стоимость)
- Группа модификаторов привязывается к продукту

### 📋 API Endpoints

#### 1. Получить список модификаторов
```
GET /admin/menu/modifiers
Query параметры:
  - modifierGroupId? (number) — фильтр по группе
```

**Response:**
```json
[
  {
    "id": 201,
    "name": "Extra Cheese",
    "description": "Дополнительный сыр моцарелла",
    "price": 150,
    "modifierGroupId": 10,
    "modifierGroupName": "Дополнительные топпинги",
    "sortOrder": 1,
    "isActive": true,
    "createdAt": "2025-01-20T10:00:00Z",
    "updatedAt": "2025-01-20T10:00:00Z"
  }
]
```

#### 2. Создать модификатор
```
POST /admin/menu/modifiers
Body: {
  "name": "Extra Cheese",
  "description": "Дополнительный сыр",
  "price": 150,
  "modifierGroupId": 10,
  "sortOrder": 1
}
```

#### 3. Обновить модификатор
```
PATCH /admin/menu/modifiers/:id
Body: {
  "name": "Double Cheese",
  "price": 200
}
```

#### 4. Удалить модификатор
```
DELETE /admin/menu/modifiers/:id
```

### 🎨 UI Компоненты

**Список модификаторов в контексте продукта:**
```
┌─────────────────────────────────────────────┐
│ Группа: "Размер пиццы"                      │
│ Правила: мин 1, макс 1, обязательно         │
├─────────────────────────────────────────────┤
│ ☰ Маленькая (25см)         +0 ₽    [✏️] [🗑️] │
│ ☰ Средняя (30см)        +200 ₽    [✏️] [🗑️] │
│ ☰ Большая (35см)        +400 ₽    [✏️] [🗑️] │
│ [+ Добавить модификатор]                    │
└─────────────────────────────────────────────┘
```

**Модальное окно создания модификатора:**
```
┌─────────────────────────────────────────┐
│  Новый модификатор                      │
├─────────────────────────────────────────┤
│ Группа: Дополнительные топпинги         │
│ Название: [Extra Cheese_______]         │
│ Цена: [+150_₽]                          │
│ Описание: [Двойная порция сыра]         │
│                                         │
│ [Отмена] [Создать]                      │
└─────────────────────────────────────────┘
```

### ✅ Проверки и валидация

1. **Название модификатора:**
   - Обязательное поле
   - Максимум 100 символов
   - Не должно дублироваться в группе

2. **Цена:**
   - Обязательное поле
   - Может быть 0 (бесплатный модификатор)
   - Минимум 0

3. **Modifier Group:**
   - Обязательное поле
   - Группа должна существовать

### 🔄 Сценарии использования

**Добавление новой опции:**
```
1. Редактируем продукт "Бургер"
2. Вкладка "Модификаторы"
3. Видим группу "Топпинги" (если уже создана)
4. Кнопка "+ Добавить модификатор"
5. Заполняем форму
6. POST /admin/menu/modifiers
7. Модификатор появляется в списке
```

**Изменение цены модификатора:**
```
1. Клик на модификатор → инлайн редактор
2. Меняем цену
3. PATCH /admin/menu/modifiers/:id
4. Цена обновляется
```

---

## Страница: Дополнения (Additions)

### 📍 Навигация
**Путь:** `Admin Panel → Меню → Дополнения`
**URL:** `/admin/menu/additions`

**Альтернативный путь:**
`Продукты → [Продукт] → Вкладка "Дополнения"`

### 🎯 Цель страницы
Управление группами дополнений и дополнительными позициями (Addition Items) для продуктов.

### 💡 Бизнес-логика

**Отличие от модификаторов:**
- Modifiers — **изменяют продукт** (размер, топпинги)
- Additions — **дополнительные товары** к продукту (соусы, напитки)

**Архитектура:**
```
Product (Пицца Маргарита)
  └── Addition: "Соусы"
      ├── Addition Item: "Чесночный соус" 50₽
      ├── Addition Item: "Барбекю соус" 50₽
      └── Addition Item: "Сырный соус" 70₽

  └── Addition: "Напитки"
      ├── Addition Item: "Coca-Cola 0.5л" 150₽
      └── Addition Item: "Fanta 0.5л" 150₽
```

**Свойства Addition:**
- `isRequired` — обязательно ли выбрать хотя бы один item
- `isMultiple` — можно ли выбрать несколько items
- `isCountable` — можно ли указать количество
- `minSelection` / `maxSelection` — ограничения выбора

**Примеры использования:**
```
Пример 1: Соусы к бургеру
├── isRequired: false (можно не брать соус)
├── isMultiple: true (можно взять несколько соусов)
├── isCountable: true (можно заказать 2 порции соуса)
└── maxSelection: 3 (максимум 3 соуса)

Пример 2: Гарнир к стейку
├── isRequired: true (обязательно выбрать гарнир)
├── isMultiple: false (только один вид гарнира)
└── minSelection: 1, maxSelection: 1
```

### 📋 API Endpoints

#### 1. Получить список additions
```
GET /admin/menu/additions
Query параметры:
  - productId? (number) — фильтр по продукту
```

**Response:**
```json
[
  {
    "id": 301,
    "name": "Соусы",
    "description": "Дополнительные соусы к блюду",
    "productId": 101,
    "productName": "Бургер Классик",
    "isRequired": false,
    "isMultiple": true,
    "isCountable": true,
    "maxSelection": 3,
    "minSelection": 0,
    "sortOrder": 1,
    "isActive": true,
    "itemsCount": 5,
    "createdAt": "2025-01-20T10:00:00Z",
    "updatedAt": "2025-01-20T10:00:00Z"
  }
]
```

#### 2. Создать addition
```
POST /admin/menu/additions
Body: {
  "name": "Соусы",
  "description": "Выберите соус к блюду",
  "productId": 101,
  "isRequired": false,
  "isMultiple": true,
  "isCountable": true,
  "maxSelection": 3,
  "minSelection": 0,
  "sortOrder": 1
}
```

#### 3. Обновить addition
```
PATCH /admin/menu/additions/:id
Body: {
  "name": "Соусы и заправки",
  "maxSelection": 5
}
```

#### 4. Удалить addition
```
DELETE /admin/menu/additions/:id
```

### 🎨 UI Компоненты

**Список additions в контексте продукта:**
```
┌────────────────────────────────────────────────┐
│ Дополнение: "Соусы"                            │
│ Правила: не обязательно, можно несколько (макс 3) │
│ Количественный: Да                              │
├────────────────────────────────────────────────┤
│ Addition Items:                                 │
│ ☰ Чесночный соус              50 ₽    [✏️] [🗑️] │
│ ☰ Барбекю соус                50 ₽    [✏️] [🗑️] │
│ ☰ Сырный соус                 70 ₽    [✏️] [🗑️] │
│ [+ Добавить item]                               │
│                                                 │
│ [Редактировать правила] [Удалить группу]        │
└────────────────────────────────────────────────┘
```

**Модальное окно создания addition:**
```
┌─────────────────────────────────────────┐
│  Новое дополнение                       │
├─────────────────────────────────────────┤
│ Название: [Соусы_______________]        │
│ Продукт: Бургер Классик                 │
│                                         │
│ Настройки выбора:                       │
│ [✓] Можно выбрать несколько             │
│ [ ] Обязательно выбрать                 │
│ [✓] Количественный выбор                │
│                                         │
│ Минимум: [0_] Максимум: [3_]            │
│                                         │
│ [Отмена] [Создать]                      │
└─────────────────────────────────────────┘
```

### ✅ Проверки и валидация

1. **Название addition:**
   - Обязательное поле
   - Максимум 100 символов

2. **Ограничения выбора:**
   - `minSelection` должен быть <= `maxSelection`
   - Если `isRequired=true`, то `minSelection >= 1`
   - Если `isMultiple=false`, то `maxSelection = 1`

3. **Product:**
   - Обязательное поле
   - Продукт должен существовать

### 🔄 Сценарии использования

**Создание дополнения к продукту:**
```
1. Редактируем продукт "Стейк"
2. Вкладка "Дополнения"
3. Кнопка "+ Создать дополнение"
4. Заполняем:
   - Название: "Гарнир"
   - Обязательно: Да
   - Можно несколько: Нет
   - Мин: 1, Макс: 1
5. POST /admin/menu/additions
6. Добавляем Addition Items (картофель, рис, овощи)
```

**Использование в заказе (POS):**
```
1. Клиент заказывает "Стейк"
2. POS показывает обязательное дополнение "Гарнир"
3. Официант выбирает "Картофель фри"
4. В заказе появляются 2 позиции:
   - Стейк — 1200₽
   - Картофель фри (к стейку) — 200₽
5. Итого: 1400₽
```

---

## Страница: Шаблоны меню

### 📍 Навигация
**Путь:** `Admin Panel → Меню → Шаблоны меню`
**URL:** `/admin/menu/templates`

### 🎯 Цель страницы
Применение готовых шаблонов меню для быстрого старта или добавления новых категорий продуктов.

### 💡 Бизнес-логика

**Зачем нужны шаблоны:**
- Быстрый онбординг нового ресторана
- Стандартизация меню для франшиз
- Добавление сезонного меню (например, "Летнее меню")

**Типы шаблонов:**
- По типу заведения (Кофейня, Пиццерия, Суши-бар)
- По категории (Завтраки, Десерты, Коктейли)
- По сезону (Летнее меню, Зимнее меню)

### 📋 API Endpoints

#### 1. Получить все шаблоны
```
GET /admin/menu/templates
```

**Response:**
```json
[
  {
    "id": 1,
    "name": "Кофейня — Базовое меню",
    "businessType": "coffee_shop",
    "description": "Стандартный набор кофейных напитков, чая и десертов",
    "categoriesCount": 5,
    "productsCount": 32,
    "previewImage": "https://cdn.example.com/templates/coffee-shop.jpg",
    "isActive": true
  }
]
```

#### 2. Получить типы заведений
```
GET /admin/menu/templates/business-types
```

**Response:**
```json
[
  { "type": "coffee_shop", "name": "Кофейня", "count": 3 },
  { "type": "pizzeria", "name": "Пиццерия", "count": 2 },
  { "type": "sushi_bar", "name": "Суши-бар", "count": 2 },
  { "type": "fast_food", "name": "Фаст-фуд", "count": 1 }
]
```

#### 3. Получить шаблоны по типу
```
GET /admin/menu/templates/business-type/:type
```

#### 4. Применить шаблон
```
POST /admin/menu/templates/:id/apply
```

**⚠️ Важно:**
- Применение шаблона **НЕ удаляет** существующее меню
- Новые категории и продукты **добавляются** к текущим
- Если категория с таким названием уже существует, продукты добавляются в неё

### 🎨 UI Компоненты

**Галерея шаблонов:**
```
┌──────────────────────────────────────────────────┐
│ Фильтр по типу: [▼ Все типы заведений]           │
├──────────────────────────────────────────────────┤
│ ┌─────────────┐  ┌─────────────┐  ┌─────────────┐│
│ │ 🖼️          │  │ 🖼️          │  │ 🖼️          ││
│ │ Кофейня     │  │ Пиццерия    │  │ Суши-бар    ││
│ │ Базовое меню│  │ Итальянская │  │ Классика    ││
│ │             │  │             │  │             ││
│ │ 5 категорий │  │ 4 категории │  │ 6 категорий ││
│ │ 32 продукта │  │ 28 продуктов│  │ 45 продуктов││
│ │             │  │             │  │             ││
│ │ [Просмотр]  │  │ [Просмотр]  │  │ [Просмотр]  ││
│ │ [Применить] │  │ [Применить] │  │ [Применить] ││
│ └─────────────┘  └─────────────┘  └─────────────┘│
└──────────────────────────────────────────────────┘
```

**Предпросмотр шаблона:**
```
┌─────────────────────────────────────────┐
│  Шаблон: Кофейня — Базовое меню         │
├─────────────────────────────────────────┤
│ Будет добавлено:                        │
│                                         │
│ 📂 Горячие напитки (12 позиций)         │
│   ├── Эспрессо                          │
│   ├── Американо                         │
│   └── ...                               │
│                                         │
│ 📂 Холодные напитки (8 позиций)         │
│ 📂 Десерты (7 позиций)                  │
│ 📂 Завтраки (5 позиций)                 │
│                                         │
│ ⚠️ Это добавится к вашему текущему меню │
│                                         │
│ [Отмена] [Применить шаблон]             │
└─────────────────────────────────────────┘
```

### ✅ Проверки и валидация

1. **Перед применением:**
   - Показать предпросмотр того, что будет добавлено
   - Предупредить о дублировании категорий
   - Показать общее количество позиций после применения

2. **После применения:**
   - Показать уведомление об успешном добавлении
   - Предложить перейти к редактированию новых позиций

### 🔄 Сценарии использования

**Онбординг новой кофейни:**
```
1. Новый клиент регистрируется
2. Выбирает "Кофейня" как тип заведения
3. Система предлагает шаблон "Кофейня — Базовое меню"
4. Клиент просматривает предпросмотр
5. Применяет шаблон
6. Получает готовое меню из 32 позиций
7. Редактирует цены под свой регион
```

**Добавление сезонного меню:**
```
1. Действующая пиццерия
2. Лето — хочет добавить холодные напитки и салаты
3. Применяет шаблон "Летнее меню"
4. Новые категории добавляются к существующим
5. Редактирует под свои нужды
```

---

## Страница: Настройки по филиалам (Branch Overrides)

### 📍 Навигация
**Путь:** `Admin Panel → Меню → Настройки по филиалам`
**URL:** `/admin/menu/branch-overrides`

**Альтернативный путь:**
`Продукты → [Продукт] → Вкладка "По филиалам"`

### 🎯 Цель страницы
Настройка индивидуальных параметров продуктов для каждого филиала сети ресторанов.

### 💡 Бизнес-логика

**Зачем нужны Branch Overrides:**
- **Разные цены** — центр города дороже, чем спальный район
- **Региональные особенности** — в прибрежных городах больше морепродуктов
- **Сезонность** — летом айс-кофе доступен везде, зимой — только в некоторых точках
- **Тестирование** — запустить новое блюдо в одном филиале до массового внедрения

**Что можно переопределить:**
- `price` — цена для конкретного филиала
- `isAvailable` — доступность (включить/выключить продукт)
- `image` — локализованное фото
- `name` — локализованное название

**Приоритет:**
```
Branch Override > Base Product Settings

Пример:
├── Базовая цена "Капучино": 350₽
├── Override для "Филиал Центр": 450₽  ← используется эта цена
└── Override для "Филиал Окраина": 280₽
```

### 📋 API Endpoints

#### 1. Получить все overrides для продукта
```
GET /admin/menu/products/:id/branches
```

**Response:**
```json
[
  {
    "branchId": 1,
    "branchName": "Филиал Центр",
    "overridePrice": 450,
    "overrideAvailability": true,
    "overrideImage": null,
    "overrideName": null,
    "isActive": true,
    "createdAt": "2025-01-20T10:00:00Z"
  },
  {
    "branchId": 2,
    "branchName": "Филиал Спальный район",
    "overridePrice": 280,
    "overrideAvailability": true,
    "isActive": true
  },
  {
    "branchId": 3,
    "branchName": "Филиал Аэропорт",
    "overridePrice": null,
    "overrideAvailability": false,
    "isActive": true
  }
]
```

#### 2. Создать/обновить override для филиала
```
PATCH /admin/menu/products/:id/branches/:branchId
Body: {
  "overridePrice": 450,
  "overrideAvailability": true,
  "overrideImage": "https://cdn.example.com/cappuccino-premium.jpg",
  "overrideName": "Премиум Капучино"
}
```

**⚠️ Важно:**
- Endpoint работает как **upsert** — создаёт или обновляет
- Можно переопределить только некоторые поля (остальные наследуются от базового продукта)
- `null` означает "использовать базовое значение"

#### 3. Получить все overrides для филиала
```
GET /admin/menu/branches/:branchId/overrides
```

**Response:**
```json
[
  {
    "productId": 101,
    "productName": "Капучино",
    "basePrice": 350,
    "overridePrice": 450,
    "overrideAvailability": true
  },
  {
    "productId": 105,
    "productName": "Чизкейк",
    "basePrice": 320,
    "overridePrice": null,
    "overrideAvailability": false
  }
]
```

### 🎨 UI Компоненты

**Таблица overrides для продукта:**
```
┌──────────────────────────────────────────────────────────────┐
│ Продукт: Капучино                                            │
│ Базовая цена: 350₽  |  Базовая доступность: Да              │
├──────────────────────────────────────────────────────────────┤
│ Филиал              │ Цена      │ Доступность │ Действия     │
├──────────────────────────────────────────────────────────────┤
│ 🏢 Центр            │ 450₽ 🔸   │ ✅ Да       │ [✏️] [🗑️]   │
│ 🏢 Спальный район   │ 280₽ 🔸   │ ✅ Да       │ [✏️] [🗑️]   │
│ 🏢 Аэропорт         │ 350₽      │ ❌ Нет 🔸   │ [✏️] [🗑️]   │
│ 🏢 Университетский  │ 350₽      │ ✅ Да       │ [✏️]         │
└──────────────────────────────────────────────────────────────┘

🔸 — переопределено (отличается от базового значения)
```

**Модальное окно редактирования:**
```
┌─────────────────────────────────────────┐
│  Настройки для филиала "Центр"          │
├─────────────────────────────────────────┤
│ Продукт: Капучино                       │
│ Базовая цена: 350₽                      │
│                                         │
│ Цена для филиала:                       │
│ ( ) Использовать базовую (350₽)        │
│ (•) Переопределить: [450_₽]            │
│                                         │
│ Доступность:                            │
│ ( ) Использовать базовую (Да)          │
│ (•) Переопределить: [✓ Доступен]       │
│                                         │
│ Фото:                                   │
│ ( ) Использовать базовое               │
│ ( ) Переопределить: [📷 Загрузить]     │
│                                         │
│ [Отмена] [Сохранить]                    │
└─────────────────────────────────────────┘
```

### ✅ Проверки и валидация

1. **Цена:**
   - Если переопределяется, должна быть >= 0
   - Показать % отклонения от базовой цены

2. **Доступность:**
   - Если продукт выключен глобально (`isAvailable=false` у базового продукта), предупредить

3. **Филиал:**
   - Проверить, что филиал существует и активен

### 🔄 Сценарии использования

**Разные цены для разных локаций:**
```
1. Открываем продукт "Капучино"
2. Вкладка "По филиалам"
3. Видим список всех филиалов
4. Для "Филиал Центр" устанавливаем цену 450₽
5. Для "Филиал Окраина" — 280₽
6. PATCH /admin/menu/products/101/branches/1
7. PATCH /admin/menu/products/101/branches/2
8. POS в каждом филиале показывает свою цену
```

**Временное отключение продукта:**
```
1. В "Филиал Аэропорт" закончился сироп для латте
2. Открываем "Латте" → "По филиалам"
3. Для "Филиал Аэропорт" отключаем доступность
4. В других филиалах латте остаётся доступным
5. Когда привезут сироп — включаем обратно
```

**Тестирование нового продукта:**
```
1. Создаём новый продукт "Раф-кофе"
2. Устанавливаем базовую доступность = false
3. В "По филиалам" включаем только для "Тестовый филиал"
4. Собираем отзывы от клиентов
5. Если успешно — включаем во всех филиалах
```

---

## Типовые сценарии использования

### 🎬 Сценарий 1: Создание нового продукта с нуля

**Задача:** Добавить новую пиццу "Пепперони" в меню.

```
Шаг 1: Создание продукта
├── Переходим: Меню → Продукты → [+ Добавить продукт]
├── Заполняем:
│   ├── Название: "Пицца Пепперони"
│   ├── Категория: "Пиццы"
│   ├── Цена: 890₽
│   ├── Тип: "Еда"
│   └── Описание: "Классическая пицца с пепперони и моцареллой"
├── Загружаем фото
└── POST /admin/menu/products

Шаг 2: Добавление модификаторов
├── Вкладка "Модификаторы"
├── Создаём группу "Размер":
│   ├── Маленькая (25см) +0₽
│   ├── Средняя (30см) +200₽
│   └── Большая (35см) +400₽
├── Создаём группу "Дополнительные топпинги":
│   ├── Моцарелла +150₽
│   ├── Халапеньо +100₽
│   └── Оливки +100₽
└── POST /admin/menu/modifiers (для каждого модификатора)

Шаг 3: Добавление дополнений
├── Вкладка "Дополнения"
├── Создаём addition "Соусы":
│   ├── isRequired: false
│   ├── isMultiple: true
│   ├── maxSelection: 3
│   └── Items:
│       ├── Чесночный 50₽
│       ├── Барбекю 50₽
│       └── Сырный 70₽
└── POST /admin/menu/additions

Шаг 4: Настройка по филиалам (опционально)
├── Вкладка "По филиалам"
├── Для "Филиал Премиум" устанавливаем цену 1100₽
└── PATCH /admin/menu/products/150/branches/1

Результат:
✅ Продукт создан и доступен в POS
✅ Официант может принять заказ с кастомизацией
✅ Система автоматически рассчитывает итоговую цену
```

### 🎬 Сценарий 2: Массовое изменение цен

**Задача:** Повысить цены на все кофейные напитки на 10%.

```
Шаг 1: Фильтрация продуктов
├── Меню → Продукты
├── Фильтр: Категория = "Горячие напитки"
└── GET /admin/menu/products?categoryId=5

Шаг 2: Массовое обновление
├── Выбираем продукты (чекбоксы)
├── Кнопка "Действия" → "Изменить цены"
├── Модалка: "Увеличить на 10%"
└── Для каждого продукта:
    └── PATCH /admin/menu/products/:id/price

Шаг 3: Проверка
├── Просматриваем обновлённые цены
├── Убеждаемся, что изменения применились
└── Синхронизация с POS происходит автоматически
```

### 🎬 Сценарий 3: Применение шаблона для нового филиала

**Задача:** Открывается новый филиал, нужно скопировать меню.

```
Шаг 1: Применение шаблона
├── Меню → Шаблоны меню
├── Выбираем "Кофейня — Базовое меню"
├── Просматриваем предпросмотр
└── POST /admin/menu/templates/1/apply

Шаг 2: Корректировка цен под регион
├── Меню → Настройки по филиалам
├── Выбираем новый филиал
├── Массово корректируем цены:
│   ├── Центральные локации: +20%
│   └── Окраины: -10%
└── Batch update через API

Шаг 3: Локальные особенности
├── Добавляем региональные продукты
├── Отключаем недоступные позиции
└── Новый филиал готов к работе
```

---

## 🔧 Технические требования к фронтенду

### Аутентификация
- Все запросы должны содержать JWT токен в заголовке `Authorization: Bearer <token>`
- Токен получается через `/auth/login`
- При 401 ошибке — автоматический refresh через `/auth/refresh`

### Обработка ошибок
```json
// Успешный ответ
Status: 200 OK
{ "id": 101, "name": "Капучино", ... }

// Ошибка валидации
Status: 400 Bad Request
{
  "statusCode": 400,
  "message": ["name should not be empty", "price must be a number"],
  "error": "Bad Request"
}

// Не найдено
Status: 404 Not Found
{
  "statusCode": 404,
  "message": "Product with ID 999 not found",
  "error": "Not Found"
}
```

### Оптимизация
- Использовать **debounce** для поиска (минимум 300ms)
- Кэшировать списки категорий (они редко меняются)
- Lazy loading для списков продуктов (пагинация)
- Оптимистичные обновления UI (не ждать ответа сервера)

### Реактивность
- Обновлять списки после создания/редактирования без перезагрузки страницы
- Показывать loading states
- Показывать toast-уведомления об успехе/ошибке

---

## 📚 Дополнительные материалы

### Swagger документация
API документация доступна по адресу: `http://localhost:3000/api/docs`

Все endpoint'ы имеют:
- Подробные описания
- Примеры запросов/ответов
- Схемы валидации
- Коды ошибок

### Связь между сущностями
```
Category
  └── Product
      ├── ModifierGroup
      │   └── Modifier
      ├── Addition
      │   └── AdditionItem
      └── BranchOverride
```

### Приоритеты разработки

**Высокий приоритет (MVP):**
1. ✅ Категории (CRUD)
2. ✅ Продукты (CRUD + быстрое редактирование цены/доступности)
3. ✅ Модификаторы (базовое управление)
4. ✅ Branch Overrides (цена + доступность)

**Средний приоритет:**
5. Additions (полное управление)
6. Шаблоны меню (применение)
7. Массовые операции

**Низкий приоритет (будущие улучшения):**
8. Импорт/экспорт меню
9. История изменений
10. A/B тестирование цен

---

**Версия документа:** 1.0
**Дата создания:** 2025-01-24
**Следующее обновление:** После реализации фронтенда

**Вопросы и предложения:** направляйте в Slack канал #admin-panel-dev
