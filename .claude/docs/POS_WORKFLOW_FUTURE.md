# POS — расширения и новые фичи

Перечень желаемых улучшений для следующей итерации разработки. Все пункты опциональны, но рекомендованы к планированию после реализации базового цикла.

## A. Умная навигация и уведомления
- **Push-обновления меню:** добавить WebSocket канал (`/ws/menu-updates`) для мгновенной синхронизации стоков без перезагрузки. Потребует модификации бэка (сейчас только REST `GET /pos/menu`).
- **Уведомления о готовности кухни:** интеграция с `KitchenTicketService` (в будущем `GET /pos/orders/{id}/kitchen-status`) и всплывающие тосты для официантов.
- **Задача фронта:** внедрить `NotificationCenter` с историей событий и фильтрацией по залу.

## B. Управление бронированиями
- **Новые API:**
  - `POST /pos/tables/reservations` — создание брони с временем и контактом.
  - `GET /pos/tables/reservations?date=...` — получение списка.
- **UI:** отдельный режим «Брони» на карте столов с цветовой маркировкой.
- **Backlog:** в домене Branch Management уже есть `TableSession`, можно расширить под будущие брони.

## C. Модуль Upsell/Combo
- **Идея:** предлагать комбо/дополнительные товары при выборе блюда.
- **API:** потребует `GET /pos/menu/products/{id}/recommendations` + конфиг в Admin (`POST /admin/menu/products/{id}/upsell`).
- **UI:** блок «Рекомендуем добавить» в модалке заказа, drag-to-add.

## D. Аналитика кассира в реальном времени
- **Панель:** виджет на главном экране с показателями смены (выручка, средний чек, чаевые).
- **API:** `GET /pos/finance/dashboard?sessionId=` (нужно реализовать в финансовом домене на базе `TransactionService`).
- **Отображение:** обновление каждые 30 секунд, индикация отклонений от планов.

## E. Интеграция с лояльностью на кассе
- **Фичи:**
  - Сканирование QR-кода гостя → автоподстановка профиля (`POST /pos/customers/lookup` с payload QR).
  - Покупка/списание подарочных сертификатов: `POST /pos/finance/giftcards` (создать), `POST /pos/finance/giftcards/redeem`.
- **UI:** отдельная панель в правой колонке с балансом, историей и быстрыми кнопками.

## F. Офлайн-режим (MVP)
- **Цель:** поддержать работу при кратковременных потерях сети.
- **Требования:**
  - Кэш меню, столов, сотрудников в IndexedDB.
  - Локальная очередь событий (`createOrder`, `closeTable`) с повтором при восстановлении сети.
  - Эндпоинт health-check `GET /pos/ping` для определения статуса.
- **Зависимости:** бэкенд должен обрабатывать идемпотентные запросы (указать `clientRequestId`).

## G. Расширенные скидки и акции
- **Админ настройки:** использовать `Admin Settings` для создания правил (связка с `FeatureFlagsService`).
- **Новые API:** `GET /pos/promotions/active`, `POST /pos/orders/{id}/promotion/apply`.
- **В UX:** блок с активными акциями, таймеры, автоматическое применение при выполнении условий.

## H. Интеграции оплаты
- **Tap-to-pay / SoftPOS:** добавить поддержку SDK на планшете и эндпоинт `POST /pos/finance/payments/{id}/capture` для завершения.
- **Отложенные платежи:** `POST /pos/finance/payments/{id}/hold` с последующим `.../capture` или `.../cancel`.
- **UI:** отображение статуса транзакции, спиннеры, управление возвратами прямо из списка заказов.

## I. Управление сменой персонала
- **Чеки смены:** реализовать `GET /pos/shifts/{id}/report` (PDF/HTML).
- **Автозакрытие смены:** напоминания при превышении лимита времени (`GET /pos/shifts/alerts`).
- **Перекрестный контроль:** возможность супервайзеру закрыть смену другого сотрудника (права через Admin).

## J. Интеграции с внешними сервисами
- **Delivery агрегаторы:** синхронизация статусов через `POST /pos/orders/{id}/external-status`.
- **Уведомления клиентам:** интеграция с SMS/email — `POST /notification/send` (использовать `NotificationModule`).
- **BI-экспорт:** cron-задача на фронте не нужна, но интерфейс для инициирования `POST /admin/analytics/export`.
